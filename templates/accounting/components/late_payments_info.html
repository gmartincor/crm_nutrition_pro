{% if service.get_payment_timing_analysis.has_late_payments %}
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
{% load tenant_tags %}
    <h4 class="text-sm font-medium text-orange-600 dark:text-orange-400 mb-2">
        Pagos Tardíos Detectados
    </h4>
    {% for late_payment in service.get_payment_timing_analysis.late_payments %}
    <div class="text-xs text-orange-700 dark:text-orange-300 mb-1">
        • {{ late_payment.payment.period_start|date:"d/m/Y" }} - {{ late_payment.payment.period_end|date:"d/m/Y" }}: 
        {{ late_payment.days_late }} día{{ late_payment.days_late|pluralize }} tarde
    </div>
    {% endfor %}
    <p class="text-xs text-gray-600 dark:text-gray-400 mt-2">
        Los pagos tardíos pueden afectar la continuidad del servicio
    </p>
    <div class="mt-2">
        <a href="{% tenant_url 'accounting:service-renewal' line_path=service.get_line_path category=service.category service_id=service.id %}" 
           class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">
            Gestionar servicio →
        </a>
    </div>
</div>
{% endif %}
